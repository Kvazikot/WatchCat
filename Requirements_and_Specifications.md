# WatchCat

## Проект watchcat
OS: Linux
OS: Windows (experimental mode)
[скачать Watchcat_Release_1.05_win64.zip](https://github.com/Kvazikot/WatchCat/tags)

Проект на с++ использует вебкамеру
Для сборки нужен opencv и cmake.

Другие программы которые использует watchcat: ffplay и ffmpeg

python нужен чтобы запустить внешний скрипт send_email

подключить opencv

vsbaranov83@gmail.com Владимир Баранов

Дата создания: 13.03.21 14:52

## Основные требования (Requirements)
* r1. запись видео при срабатывании триггера
   аудио триггер (порог громкости превышает заданное значение)
   видео триггер (в кадре есть движение)
   речевой триггер( есть определенные слова или сочетания слов в речи )

* r2. Передача емайла при срабатывании тригера (посмотреть скрипт на пайтоне)

* r3. Включение сирены (сирена сначала будет мой голос запитченный на пару тонов для устрашения)

* r4. Идентификация по лицу для отмены тревоги. Лица членов семьи.

* r5. Уничтожение заголовка раздела 

* r6. Ведение статистики, например сколько за день проехало автомобилей. Сколько прошло людей.
* r7. Программа должна работать в фоновом режиме. Поэтому нужно рабить проект на две программы консольный и GUI.
      Не обязательно. Если иксы не сбрасывать а просто блокировать компьютер.
      Для интерфейса и управления можно использовать библиотеку highgui из поставки opencv.
* r8. Для проигрывания аудио можно использовать ffmpeg
* r9. Для проигрывания аудио в Windows можно использовать использовать фцнкцию PlaySound
* r10. Для проигрывания аудио в Linux можно использовать использовать gstreamer framework  
* r11. Использовать pipe для вывода видео из консольной программы через stdout в формате mjpeg
* r12. Использовать shared memory для вывода видео в GUI


## Программа Watchcat. Functional Requirements
* r221. Желательно чтобы watchcat принимал вход из сети. Например при трансляции видео со сматрфона.
        В линуксе это можно сделать используя gstreamer. <br>
        В windows можно принимать картинку используя qt. 
* r222. Желательно работа в тихом режиме (низкое потребление энергии)
         Исключает возможность использования ресурсозатратных триггеров.
* r223. Возможность выбирать тип триггеров


## Программа WatchcatGUI. Functional Specifications. GUI.
* s122. Программа с графическим интерфейсом на основе библиотеки с открытым кодом Qt 5.9.
* s123. WatchcatGUI взаимодействует с watchcat через shared memory.
 
## Программа WatchcatGUI. Interface Requirements. 
* r124. Программа должна иметь две вкладки. 
* r125. На первой вкладке идет изображение с камеры.
* r126. На первой вкладке кнопки включающие триггеры(движение в кадре) и алерты(звук, письмо на емайл).
* r127. На второй вкадке текст сообщения с алертом и список получателей.

## Программа Watchcat. Functional Specifications.
* s765. Использование shared memory. В консольной версии watchcat желательно использовать native API без привязки к QT.

##  Программа Watchcat. Performance Requirements. Ресурсозатратные Триггеры.
Используя dlib и обученную нейросеть можно добавить к текущей версии watchcat следующие триггеры:

* s825. триггер при появлениии в кадре лица
* s826. триггер при появлениии в кадре человека
* s827. триггер при появлениии в кадре авто
* s828. 
<br> 
<b>Недостатки</b>. Для распознавания сложных образов требуется машина с хорошей видеокартой.
Это исключает спасение бедных детишек из Бангладеш от злых Терминаторов. Эхо Сталина все еще не дает мне спокойно спать.

## GUI Программа WatchcatGUI. Safery Requirements. Разблокировка по лицу.
В линуксе для этого есть готовое решение - howdy.
<b>Недостатки</b>.
Но работает через раз и требует настройки, много возни. Может полностью заблокировать графический интерфейс.



## Обработка аудио

Библиотека kfr оптимизирована для работы в реальном времени.
https://github.com/kfrlib/kfr/blob/master/examples/dft.cpp

## Обработка видео
Библиотека opencv 
Дополнительные библиотеки для motion tracking и идентификации по лицу.


## Использование watchcat в сматрфонах и rasbery py.
В качестве платформы можно использовать rasbery pi с дебианом.
Можно использовать андройд смартфон в качестве мозгового центра.
Можно помотреть какие продаются датчики движения.


### Программа Watchcat. Specifications. Алгоритм детекции движения:

1. Берется два последовательных кадра.
2. Берется серые компоненты
3. Гаусс сглаживания обоих кадров
4. Абсолютная разница между кадрами
5. Морфологический фильтр dilate
6. Поиск контуров
7. Нахождение максимального контура по площади
8. Срабатывание тревоги если таких контуров больше 3.


